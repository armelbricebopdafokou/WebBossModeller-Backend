name: test-userservice

on:
    push:
        branches: ["userservice-dev"]
    pull_request:
        paths:
          - Userservice/**
        branches: ["userservice-dev"]
    # Allows you to run this workflow manually from the Actions tab
    workflow_dispatch:
    
jobs:
    build:

        runs-on: ubuntu-latest
    
        steps:
          - name: change the directory
            run: | 
                  pwd
                  cd Userservice
          - uses: actions/checkout@v4
          - name: Use Node.js
            uses: actions/setup-node@v4
            with:
              node-version: '20.x'
         
          - name: Install dependencies
            run: npm install # npm ci is faster but it uses package.lock.json
          - run: npm run build --if-present
          - name: Execute test
            run: npm  run test
    
    deploy:
      needs: build
      runs-on: ubuntu-latest
      steps:
        - name: pull request to deployment Branch
          uses: s0/git-publish-subdir-action@develop
          env:
            REPO: self
            BRANCH: deployment
            FOLDER: Userservice
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            TARGET_DIR: .
